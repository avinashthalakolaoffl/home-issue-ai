<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload Issue | Smart Home Assist</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome (MUST be here for logo icon) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<nav class="navbar navbar-dark bg-primary px-4">
    <span class="navbar-brand app-logo">
        <i class="fa-solid fa-house-circle-check"></i>
        <span class="logo-text">Smart Home Assist</span>
    </span>
    <a href="/logout" class="btn btn-light btn-sm">Logout</a>
</nav>




<div class="container mt-5">
    <div class="card shadow p-4">
        <h3 class="mb-3">Upload Home Issue Image</h3>
        <p class="text-muted">
            Upload a clear image of the issue (plumbing, electrical, wall damage, etc.)
        </p>

<form id="uploadForm" action="/upload_image" method="post" enctype="multipart/form-data">

    <input type="file" name="image" class="form-control mb-3" required>

    <button type="submit" id="analyzeBtn" class="btn btn-primary">
        <i class="fa-solid fa-magnifying-glass"></i> Analyze Issue
    </button>


<!-- Loading box -->
<div id="loadingBox" class="mt-4" style="display:none;">

    <p class="text-muted mb-2">
        <i class="fa-solid fa-spinner fa-spin"></i>
        Analyzing image, please wait...
    </p>

    <div class="progress" style="height: 22px;">
        <div
            id="progressBar"
            class="progress-bar"
            role="progressbar"
            style="width: 0%; background-color: red;">
            0%
        </div>
    </div>

</div>




</form>

    </div>
</div>

<script>
document.getElementById("uploadForm").addEventListener("submit", function (e) {
    e.preventDefault(); // â›” stop immediate submission

    const analyzeBtn = document.getElementById("analyzeBtn");
    const loadingBox = document.getElementById("loadingBox");
    const progressBar = document.getElementById("progressBar");

    analyzeBtn.disabled = true;
    loadingBox.style.display = "block";

    let progress = 0;

    const interval = setInterval(() => {
        progress += 5;   // ðŸ‘ˆ SLOW & VISIBLE

        if (progress > 100) progress = 100;

        progressBar.style.width = progress + "%";
        progressBar.innerText = progress + "%";

        if (progress < 40) {
            progressBar.style.backgroundColor = "#dc2626"; // red
            progressBar.style.color = "#fff";
        } else if (progress < 70) {
            progressBar.style.backgroundColor = "#facc15"; // yellow
            progressBar.style.color = "#000";
        } else {
            progressBar.style.backgroundColor = "#16a34a"; // green
            progressBar.style.color = "#fff";
        }

        if (progress === 100) {
            clearInterval(interval);
            // âœ… submit form AFTER animation finishes
            document.getElementById("uploadForm").submit();
        }
    }, 300); // ðŸ‘ˆ visible speed
});
</script>

</body>
</html>
